!function(a){a.fn.tzTypeChooseExtraField=function(b){function c(){f.find(d.sortCancel).die("click").live("click",function(b){b.preventDefault();var c=confirm(d.deleteText);c&&(a(this).parents(".tz-drag").remove(),f.find('input[name="'+d.inputHiddenName+'"]').length||g.val("").appendTo(e))})}var d=a.extend({fieldListId:"#tz-extra-field",draggableItem:".tz-drag",fieldChosenId:"#tz-shortcode-type",inputHiddenName:"jform[extrafields][]",insideItem:".tz-inside",dataIdPrefix:"tz-extrafield-drag-",deleteText:"Are you sure to delete this options?",dragzIndex:100,dragCursor:"move",dragHandle:".tz-title",dragHelper:"clone",dragConnectToSortable:!1,sortItems:".tz-drag:not(.placeholder)",sortCursor:"move",sortDistance:2,sortCancel:".tz-delete",sortPlaceholder:"tz-placeholder",sortDeactivate:function(){},sortStop:function(){},dropTolerance:"pointer",dropActiveClass:"tz-state-default",dropHoverClass:"ui-state-hover",dropAccept:":not(.ui-sortable-helper)",drop:function(){}},b),e=a(d.fieldListId),f=a(d.fieldChosenId),g=e.find('input[name="'+d.inputHiddenName+'"]');f.find('input[name="'+d.inputHiddenName+'"]').length&&e.find(g).remove(),c()},a.tzProcessLayout=function(b,c){{var d=a(b),e=a.extend({},a.tzProcessLayout.defaults,c),f=d.find(e.strItem);f.find(e.strElementParent)}e.obj=d,a.tzProcessLayout.settings=e;{var g=f.find(e.strElement).data("row-id"),h=d.find(e.strToolbar).next().last();f.find(e.strItem).clone(!0)}a(e.strModal).on("hidden",function(){a(e.strItem+","+e.strElementParent).removeClass(e.strActive.replace(".","")).find(e.strElement).removeClass(e.strActive.replace(".",""))}),a(e.strModalField).on("hidden",function(){a(e.strItem).removeClass(e.strActive.replace(".",""))}),f.undelegate(" >"+e.strToolbar+" .tz-add-item","click").delegate(" >"+e.strToolbar+" .tz-add-item","click",function(){var b=a(this).parent().parent().parent();b.addClass(e.strActive.replace(".",""));var c=a(e.strItem+e.strActive).parents(e.strInner).eq(0),f=c.find(e.strItem+e.strActive).parent().eq(0).find(">"+e.strItem).index(c.find(e.strItem+e.strActive));b.after(b.parent().find(">"+e.strItemHidden).clone(!0).wrap("<div></div>").parent().html().replace(e.strItemHidden.replace(".",""),"").replace(/\{|\}/gi,"")),a(e.strLoopItems).length&&a(e.strLoopItems).each(function(b,d){c.find(d+e.strLoopItemHidden).length&&a(c.find(d)[f]).after(a(d+e.strLoopItemHidden).clone(!0).wrap("<div></div>").parent().html().replace(e.strLoopItemHidden.replace(".",""),"").replace(/\{|\}/gi,""))}),b.removeClass(e.strActive.replace(".","")),new a.tzProcessLayout(d,e)}),f.undelegate(" >"+e.strToolbar+" .tz-edit-item","click").delegate(" >"+e.strToolbar+" .tz-edit-item","click",function(){var b=a(this).parent().parent().parent();b.addClass(e.strActive.replace(".","")),a(e.strModalField).find("#tz-form-field").html(a(this).parent().parent().find("> .tz-form-hidden").clone(!0).html())}),d.delegate(e.strInner+" >"+e.strToolbar+" .tz-edit-item","click",function(){var b=a(this).parent().parent().parent();b.addClass(e.strActive.replace(".","")),a(e.strModalField).find("#tz-form-field").html(a(this).parent().parent().find("> .tz-form-hidden").clone(!0).html())}),d.undelegate(e.strModalField+" .tz-add-value","click").delegate(e.strModalField+" .tz-add-value","click",function(){var b=a(e.strModalField).find("#tz-form-field").serializeArray().reduce(function(a,b){return b.name.match(/\[\]/i)?a[b.name.replace(/\[\]/i,"")]?a[b.name.replace(/\[\]/i,"")]+=" "+b.value:a[b.name.replace(/\[\]/i,"")]=b.value:a[b.name]=b.value,a},{}),c=a(e.strItem+e.strActive).parents(e.strInner).eq(0),f=c.find(e.strItem+e.strActive).parent().eq(0).find(">"+e.strItem).index(c.find(e.strItem+e.strActive)),g=a(e.strItem+e.strActive).parent().find(">"+e.strItemHidden);if(a(e.strLoopItems).length)a(e.strLoopItems).each(function(a,d){if(c.find(d).length){var g=c.find(d).eq(f).parent().eq(0).find(">"+d+e.strLoopItemHidden).clone(!0);if(g&&g.length){var h=g[0].outerHTML.replace(e.strLoopItemHidden.replace(".",""),""),i=h.match(/(\{.*?\})/gi);i&&i.length>1&&b&&(i.each(function(a){var c=a.replace(/\{|\}/gi,"");h=b[c]?h.replace(a.trim(),b[c]):h.replace(a.trim(),"")}),c.find(d).eq(f).after(h).remove())}}});else{var h=a(e.strItem+e.strActive).parent().find(e.strItem+e.strItemHidden),i=h.clone(!0).html(),j=i.match(/(\{)(.*?)(\})/i);j&&j.length>0&&b&&a(a(e.strItem)[f]).html(i.replace(/\{.*?\}/i,b[j[2]]))}if(g&&g.length){var k=g.clone(!0).wrap("<div></div>").parent(),l=k.html().replace(e.strItemHidden.replace(".",""),""),m=l.match(/(\{.*?\})/gi);m&&m.length>0&&b&&(m.each(function(a){var c=a.replace(/\{|\}/gi,"");k.html(b[c]?k.html().replace(e.strItemHidden.replace(".",""),"").replace(a.trim(),b[c]):k.html().replace(e.strItemHidden.replace(".",""),"").replace(a.trim(),""))}),a(e.strItem+e.strActive).find(">"+e.strElement).length&&a(e.strItem+e.strActive).find(">"+e.strElement).each(function(){a(this).find(">"+e.strEmpty).length||(k.find(">"+e.strItem).find(">"+e.strElement).find(">"+e.strEmpty).length&&k.find(">"+e.strItem).find(">"+e.strElement).remove(),k.find(">"+e.strItem).append(a(this)))}),a(e.strItem+e.strActive).after(k.html()).remove())}new a.tzProcessLayout(d,e),a(e.strModalField).modal("hide")}),f.undelegate(">"+e.strToolbar+" .tz-clone-item","click").delegate(">"+e.strToolbar+" .tz-clone-item","click",function(){var b=a(this).parent().parent().parent(),c=b.parents(e.strInner).eq(0),d=c.find(b).parent().eq(0).find(">"+e.strItem).index(c.find(b));b.after(b.clone(!0)),a(e.strLoopItems).length?a(e.strLoopItems).each(function(a,b){c.find(b).length&&c.find(b).eq(d).after(c.find(b).eq(d).clone(!0))}):a(e.strItem).eq(d).after(a(e.strItem).eq(d))}),f.undelegate(">"+e.strToolbar+" .tz-delete-item","click").delegate(">"+e.strToolbar+" .tz-delete-item","click",function(){var b=a(this).parent().parent().parent().parent().find(">"+e.strItem+":not("+e.strItemHidden+")").length;if(b>1){if(a(e.strLoopItems).length){var c=a(this).parents(e.strInner).eq(0),d=c.find(a(this).parent().parent().parent()).parent().eq(0).find(">"+e.strItem).index(c.find(a(this).parent().parent().parent()));a(e.strLoopItems).each(function(a,b){c.find(b).eq(d).remove()})}else{var d=a(e.strItem).index(a(this).parent().parent().parent());a(a(a(e.strLoopItem)[d])).remove()}a(this).parent().parent().parent().remove()}return!1}),e.addRow&&(f.undelegate(e.strEmpty,"click").delegate(e.strEmpty,"click",function(){a(this).parent().addClass(e.strActive.replace(".",""));var b=a(this);a(e.strModal).find(".modal-body iframe").attr("src",function(a,c){if(b.attr("data-row-id")){if(c.match(/\&row_id\=([0-9]+)\&?/i)){var d=/(.*?\&row_id=)([0-9]+)(\&?)/i;return c.replace(d,"$1"+b.data("row-id")+"$3")}return c+"&row_id="+b.data("row-id")}}).one("load",function(){a(e.strModal).modal("show")})}),f.undelegate(">"+e.strToolbar+" .tz-add-element","click").delegate(">"+e.strToolbar+" .tz-add-element","click",function(){a(this).parent().addClass(e.strActive.replace(".","")).parent().addClass(e.strActive.replace(".",""));var b=a(this);a(e.strModal).find(".modal-body iframe").attr("src",function(a,c){if(b.attr("data-row-id")){if(c.match(/\&row_id\=([0-9]+)\&?/i)){var d=/(.*?\&row_id=)([0-9]+)(\&?)/i;return c.replace(d,"$1"+b.data("row-id")+"$3")}return c+"&row_id="+b.data("row-id")}}).one("load",function(){a(e.strModal).modal("show")})}),f.undelegate(e.strElement+" "+e.strToolbar+" .tz-add-row","click").delegate(e.strElement+" "+e.strToolbar+" .tz-add-row","click",function(){var b=a(this).parent().parent().parent();return a.get(e.root+e.path+"/layout_element_row.php?time="+a.now(),function(c){g++,a(c).attr("data-row-id",g).find(e.strEmpty).attr("data-row-id",g).end().insertAfter(b).slideDown("slow"),a.tzRowSortable()}),!1})),f.undelegate(e.strElement+" >"+e.strToolbar+" .tz-duplicate-row","click").delegate(e.strElement+" >"+e.strToolbar+" .tz-duplicate-row","click",function(){var b=a(this).parent().parent().parent();g++,b.after(b.clone(!0).attr("data-row-id",g))}),f.undelegate(e.strElement+" >"+e.strToolbar+" .tz-delete-row","click").delegate(e.strElement+" >"+e.strToolbar+" .tz-delete-row","click",function(){var b=a(this).parent().parent().parent().parent().find(">"+e.strElement).length;if(b>1)a(this).parent().parent().parent().remove();else{{a(this).parent().parent(e.strToolbar)}a(this).parent().parent().parent().children().remove(":not("+e.strToolbar+")").end().append(h.clone(!0))}return!1}),a.tzItemSortable(),a.tzRowSortable()},a.tzProcessLayout.defaults={strItemParent:".tz-shortcode-item-outer",strItem:".tz-shortcode-item",strInner:".tz-shortcode-inner",strItemHidden:".tz-shortcode-item-hidden",strElementParent:".tz-loop",strElement:".tz-element",strModal:"#tzCollapseModal",strModalField:"#tzCollapseModalField",strToolbar:".btn-toolbar",strEmpty:".tz-empty",strActive:".tz-active",strLoopItems:[],strLoopItem:".tz-loop-item",strLoopItemHidden:".tz-loop-item-hidden",strDisplayBlock:".tz-display-block",moveRow:!0,addRow:!0,root:"",path:"/administrator/components/com_jvisualcontent/views/type/tmpl"},a.tzProcessLayout.settings=a.tzProcessLayout.defaults,a.tzRowSortable=function(){a(a.tzProcessLayout.settings.strElement).parent().sortable({axis:"x,y",handle:".move-row",items:">"+a.tzProcessLayout.settings.strElement,tolerance:"pointer",placeholder:"tz-placeholder tz-placeholder-warning"}).disableSelection()},a.tzItemSortable=function(){var b=0;a(a.tzProcessLayout.settings.strItem).parent().sortable({axis:"x,y",handle:".tz-move-item",items:">"+a.tzProcessLayout.settings.strItem,tolerance:"pointer",placeholder:"tz-placeholder-item tz-placeholder-warning",start:function(c,d){{var e=a(d.item).parents(a.tzProcessLayout.settings.strInner).eq(0);e.find(d.item).parent().eq(0).find(">"+a.tzProcessLayout.settings.strItem).index(d.item)}b=a(a.tzProcessLayout.settings.strItem).index(d.item),a(this).find(">"+a.tzProcessLayout.settings.strItem+":not("+a.tzProcessLayout.settings.strItemHidden+")").addClass(a.tzProcessLayout.settings.strDisplayBlock.replace(".","")),a(this).sortable("refresh")},stop:function(c,d){var e=a(d.item).parents(a.tzProcessLayout.settings.strInner).eq(0),f=e.find(d.item).parent().eq(0).find(">"+a.tzProcessLayout.settings.strItem).index(d.item);a(a.tzProcessLayout.settings.strLoopItems).length?a(a.tzProcessLayout.settings.strLoopItems).each(function(c,d){e.find(d).eq(f).after(a(d).eq(b))}):a(a.tzProcessLayout.settings.strLoopItem).eq(f).after(a(a.tzProcessLayout.settings.strLoopItem).eq(b)),a(this).find(">"+a.tzProcessLayout.settings.strItem+":not("+a.tzProcessLayout.settings.strItemHidden+")").removeClass(a.tzProcessLayout.settings.strDisplayBlock.replace(".","")),a(this).sortable("refresh")}}).disableSelection()},a.tzAddHtmlToRow=function(b){a(a.tzProcessLayout.settings.strElement+a.tzProcessLayout.settings.strActive).find(" >"+a.tzProcessLayout.settings.strEmpty).after(a(b)).remove().end().removeClass(a.tzProcessLayout.settings.strActive.replace(".","")).parent().removeClass(a.tzProcessLayout.settings.strActive.replace(".","")),a(a.tzProcessLayout.settings.strModal).modal("hide"),new a.tzProcessLayout(a.tzProcessLayout.settings.obj,a.tzProcessLayout.settings)},a.fn.tzProcessLayout=function(b){return void 0===b&&(b={}),"object"==typeof b?new a.tzProcessLayout(this,b):void 0}}(jQuery);